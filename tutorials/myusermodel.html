
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>User model example &#8212; pyspextools 0.3.4 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="APEC interface for SPEX" href="apec.html" />
    <link rel="prev" title="SIMRES" href="simres.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="apec.html" title="APEC interface for SPEX"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="simres.html" title="SIMRES"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyspextools 0.3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorials.html" accesskey="U">Using the pyspextools module</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="user-model-example">
<span id="user-example"></span><h1>User model example<a class="headerlink" href="#user-model-example" title="Permalink to this headline">¶</a></h1>
<p>The myusermodel.py file in the examples directory contains a basic program
that interacts with the user or musr model in SPEX. It reads the input energy
grid and model parameters from SPEX, calculates a spectrum or transmission, and
returns the calculated values by writing a text file. The user can adapt this
example to his/her own needs.</p>
<p><strong>Imports</strong></p>
<p>The following imports are mandatory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>                         <span class="c1"># Import math module</span>
<span class="kn">import</span> <span class="nn">numpy</span>                        <span class="c1"># Import numpy module</span>
<span class="kn">from</span> <span class="nn">pyspextools.model</span> <span class="kn">import</span> <span class="n">User</span>  <span class="c1"># Import the user module from pyspextools.model</span>
</pre></div>
</div>
<p><strong>Initialisation</strong></p>
<p>The user module from pyspextools.model needs to be initialized first. This will read in
the input file from SPEX automatically and initialize the arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usr</span><span class="o">=</span><span class="n">User</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Calculation</strong></p>
<p>This step needs the creativity of the user. The module reference page <a class="reference internal" href="../user.html#usermodel"><span class="std std-ref">SPEX user model interface module</span></a> provides an overview of the
parameters of the user module that can be used in the program. At least, the output spectrum or transmission
needs to be calculated and written to the ‘usr.sener’ output array. This array will be passed back to SPEX after
the calculation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each energy bin in the provided energy grid</span>
<span class="c1"># calculate the spectrum in photons/s/bin:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">usr</span><span class="o">.</span><span class="n">neg</span><span class="p">):</span>
  <span class="n">usr</span><span class="o">.</span><span class="n">sener</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mf">1.</span><span class="o">-</span> <span class="n">usr</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">usr</span><span class="o">.</span><span class="n">eg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="n">usr</span><span class="o">.</span><span class="n">wener</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
</pre></div>
</div>
<p>In this case, a simple exponential function is returned as an example, but this
function can be as simple or complicated as needed. The unit for the ‘usr.sener’ array is
‘photons/s/bin’ and this example function also uses the first model input parameter ‘user.par[0]’
from SPEX and the bin energy <cite>usr.eg</cite> (see <a class="reference internal" href="../user.html#usermodel"><span class="std std-ref">SPEX user model interface module</span></a> for a full description).</p>
<blockquote>
<div><p><strong>NOTE:</strong> There is a difference between the index of the array and the parameter number in SPEX.
The parameter number in SPEX is equal to the array index + 1, since Python starts counting
at 0 and SPEX at 1.</p>
</div></blockquote>
<p>The ‘usr.wener’ array can be used to optimize the calculations in SPEX.
If Delta E = average photon energy within the bin (keV) minus the bin
centroid then wener = sener * Delta E.</p>
<p><strong>Write output</strong></p>
<p>The result needs to be handed back to SPEX through a text file, which can be
written by calling the ‘usr.write_spc()’ function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write the calculated spectrum to the output file:</span>
<span class="n">usr</span><span class="o">.</span><span class="n">write_spc</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>When the program is ready, copy it to a convenient location and make it
executable using the shell command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">linux</span><span class="p">:</span><span class="o">~&gt;</span> <span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">x</span> <span class="n">myusermodel</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>In SPEX, this program can be loaded into the ‘user’ or ‘musr’ model using
the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SPEX</span><span class="o">&gt;</span> <span class="n">com</span> <span class="n">user</span>
<span class="n">SPEX</span><span class="o">&gt;</span> <span class="n">par</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">exec</span> <span class="n">av</span> <span class="o">./</span><span class="n">myusermodel</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The ‘./’ is used if the program is in the current working directory. Otherwise,
please use the full path to the program.</p>
<p>The ‘user’ and ‘musr’ model also needs the number of parameters that the
model needs. Set it using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SPEX</span><span class="o">&gt;</span> <span class="n">par</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">npar</span> <span class="n">v</span> <span class="mi">1</span>
</pre></div>
</div>
<p>You can set your model parameters in a similar way. Have fun!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">User model example</a><ul>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="simres.html"
                        title="previous chapter">SIMRES</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="apec.html"
                        title="next chapter">APEC interface for SPEX</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/myusermodel.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="apec.html" title="APEC interface for SPEX"
             >next</a> |</li>
        <li class="right" >
          <a href="simres.html" title="SIMRES"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyspextools 0.3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorials.html" >Using the pyspextools module</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018-2019, SRON Netherlands Institute for Space Research.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>