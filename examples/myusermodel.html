
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>User model example &#8212; pyspex 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="PySPEX Example programs" href="../examples.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../examples.html" title="PySPEX Example programs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyspex 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../examples.html" accesskey="U">PySPEX Example programs</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="user-model-example">
<span id="user-example"></span><h1>User model example<a class="headerlink" href="#user-model-example" title="Permalink to this headline">¶</a></h1>
<p>The myusermodel.py file in the examples directory contains a basic program
that interacts with the user or musr model in SPEX. It reads the input energy
grid and model parameters from SPEX, calculates a spectrum or transmission, and
returns the calculated values by writing a text file. The user can adapt this
example to his/her own needs.</p>
<p><strong>Imports</strong></p>
<p>The following imports are mandatory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>                  <span class="c1"># Import math module</span>
<span class="kn">import</span> <span class="nn">numpy</span>                 <span class="c1"># Import numpy module</span>
<span class="kn">from</span> <span class="nn">pyspex.user</span> <span class="k">import</span> <span class="n">IO</span>   <span class="c1"># Import IO from pyspex.user</span>
</pre></div>
</div>
<p><strong>Initialisation</strong></p>
<p>The IO module from pyspex.user needs to be initialized first. This will read in
the input file from SPEX automatically and initialize the arrays:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usr</span><span class="o">=</span><span class="n">IO</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Calculation</strong></p>
<p>This step needs the creativity of the user. The output spectrum or transmission
needs to be calculated and written to the ‘usr.sener’ output array:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># For each energy bin in the provided energy grid</span>
<span class="c1"># calculate the spectrum in photons/s/bin:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">usr</span><span class="o">.</span><span class="n">neg</span><span class="p">):</span>
  <span class="n">usr</span><span class="o">.</span><span class="n">sener</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mf">1.</span><span class="o">-</span> <span class="n">usr</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">usr</span><span class="o">.</span><span class="n">eg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="n">usr</span><span class="o">.</span><span class="n">wener</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
</pre></div>
</div>
<p>The unit for the ‘usr.sener’ array is ‘photons/s/bin’ and the bin parameters are
available in the ‘usr’ object (see <a class="reference internal" href="../user.html#usermodel"><span class="std std-ref">SPEX user model interface module</span></a>). The model parameters from
SPEX can be accessed through the ‘usr.par’ array. Note the difference between
the index of the array and the parameter number in SPEX. The parameter number in
SPEX is equal to the array index + 1.</p>
<p>The ‘usr.wener’ array can be used to optimize the calculations in SPEX.
If Delta E = average photon energy within the bin (keV) minus the bin
centroid then wener = sener * Delta E.</p>
<p><strong>Write output</strong></p>
<p>The result needs to be handed back to SPEX through a text file, which can be
written by calling the ‘usr.writespc()’ function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Write the calculated spectrum to the output file:</span>
<span class="n">usr</span><span class="o">.</span><span class="n">writespc</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>When the program is ready, copy it to a convenient location and make it
executable using the shell command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">linux</span><span class="p">:</span><span class="o">~&gt;</span> <span class="n">chmod</span> <span class="n">u</span><span class="o">+</span><span class="n">x</span> <span class="n">myusermodel</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>In SPEX, this program can be loaded into the ‘user’ or ‘musr’ model using
the following commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SPEX</span><span class="o">&gt;</span> <span class="n">com</span> <span class="n">user</span>
<span class="n">SPEX</span><span class="o">&gt;</span> <span class="n">par</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">exec</span> <span class="n">av</span> <span class="o">./</span><span class="n">myusermodel</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The ‘./’ is used if the program is in the current working directory. Otherwise,
please use the full path to the program.</p>
<p>The ‘user’ and ‘musr’ model also needs the number of parameters that the
model needs. Set it using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SPEX</span><span class="o">&gt;</span> <span class="n">par</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">npar</span> <span class="n">v</span> <span class="mi">1</span>
</pre></div>
</div>
<p>You can set your model parameters in a similar way. Have fun!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">User model example</a><ul>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../examples.html"
                        title="previous chapter">PySPEX Example programs</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/myusermodel.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../examples.html" title="PySPEX Example programs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyspex 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../examples.html" >PySPEX Example programs</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Jelle de Plaa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>